<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <title>API Doc</title>
  <!--<script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>-->
  <script type='module' src='https://cdn.jsdelivr.net/npm/rapidoc/dist/rapidoc-min.js'></script>
</head>
<body>
</body>
<script>
  {
    let href = new URL(location.href);
    let specPath = 'api-json'; // nestjs api-json, trpc api/openapi.json
    let url = href.searchParams.get('url') || `${href.pathname.replace(/docs.html$/, '')}${specPath}`;
    let el = document.createElement('rapi-doc');
    // https://rapidocweb.com/api.html
    let attrs = {
      'spec-url': url,
      'server-url': location.origin,
      'default-api-server': location.origin,
      'persist-auth': 'true',
      'use-path-in-nav-bar': 'true',
      'show-method-in-nav-bar': 'as-colored-block',
    };
    Object.entries(attrs).forEach(([k, v]) => {
      attrs[k] = href.searchParams.get(k) || v;
    });
    console.info(`Render Docs with attrs:`, attrs)
    for (let [key, value] of Object.entries(attrs)) {
      el.setAttribute(key, value);
    }
    document.body.appendChild(el);
    globalThis.$doc = el;
  }
</script>
</html>
